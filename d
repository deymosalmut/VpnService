–û—Ç–ª–∏—á–Ω–æ, —á—Ç–æ —Ç—ã –ø–æ–∫–∞–∑–∞–ª **devmenu-–ø—Ä–æ–≥–æ–Ω —Ü–µ–ª–∏–∫–æ–º** ‚Äî –ø–æ —ç—Ç–æ–º—É –ª–æ–≥—É –≤–∏–¥–Ω–æ **—Ç–æ—á–Ω–æ**, –≥–¥–µ –º—ã —Å–µ–π—á–∞—Å –Ω–∞—Ö–æ–¥–∏–º—Å—è –∏ –ø–æ—á–µ–º—É –æ—à–∏–±–∫–∞ –≤—Å—ë –µ—â—ë –≤–æ–∑–Ω–∏–∫–∞–µ—Ç.

## –ö–æ—Ä–æ—Ç–∫–æ: –ø—Ä–æ–±–ª–µ–º–∞ –ù–ï —Ä–µ—à–µ–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é

AmbiguousMatchException **–≤—Å—ë –µ—â—ë –µ—Å—Ç—å**, –Ω–æ —Ç–µ–ø–µ—Ä—å –ø—Ä–∏—á–∏–Ω–∞ —Å—Ç–∞–ª–∞ –∫—Ä–∏—Å—Ç–∞–ª—å–Ω–æ —è—Å–Ω–æ–π üëá

```
The request matched multiple endpoints. Matches:

VpnService.Api.Controllers.AdminWireGuardController.GetState
VpnService.Api.Controllers.V1.WireGuardAdminController.GetState
```

‚û°Ô∏è **–£ —Ç–µ–±—è –æ—Å—Ç–∞–ª–∏—Å—å –î–í–ê —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞**, –ø—Ä–æ—Å—Ç–æ –æ–Ω–∏ —Ç–µ–ø–µ—Ä—å –≤ **—Ä–∞–∑–Ω—ã—Ö namespaces**:

* `Controllers/AdminWireGuardController`
* `Controllers/V1/WireGuardAdminController`

ASP.NET Core **–Ω–µ –≤–æ–ª–Ω—É–µ—Ç namespace**, –µ–º—É –≤–∞–∂–Ω—ã:

* HTTP method
* Route

–ï—Å–ª–∏ route –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π ‚Üí –±—É–¥–µ—Ç ambiguity.

---

# ‚úÖ –ö–ê–ù–û–ù–ò–ß–ï–°–ö–û–ï –†–ï–®–ï–ù–ò–ï (–¥–µ–ª–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ)

–ú—ã —Å–µ–π—á–∞—Å –Ω–∞ **Stage 3 Day 1**, –ø–æ –º–µ—Ç–æ–¥–∏—á–∫–µ:

> ‚ùó –î–û–õ–ñ–ï–ù –ë–´–¢–¨ –û–î–ò–ù admin endpoint
> `GET /api/v1/admin/wg/state`

### ‚úî –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å

* `V1/*` ‚Äî **–ø—É–±–ª–∏—á–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ API**
* `Admin*` ‚Äî **–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ admin endpoints**

WireGuard admin **–ù–ï –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ V1**.

---

## üîß –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –°–ï–ô–ß–ê–° (2 –º–∏–Ω—É—Ç—ã)

### –®–∞–≥ 1. –£–¥–∞–ª–∏—Ç—å V1 WireGuard controller

–ù–∞ Ubuntu:

```bash
cd /opt/vpn-service/VpnService

git rm VpnService.Api/Controllers/V1/WireGuardAdminController.cs
```

–∏–ª–∏ –µ—Å–ª–∏ —Ç—ã –Ω–µ —Ö–æ—á–µ—à—å —É–¥–∞–ª—è—Ç—å —Ñ–∞–π–ª –Ω–∞–≤—Å–µ–≥–¥–∞ ‚Äî –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏:

```bash
mv VpnService.Api/Controllers/V1/WireGuardAdminController.cs \
   VpnService.Api/Controllers/V1/WireGuardAdminController.cs.DISABLED
```

> ‚ö†Ô∏è –ù–æ **git rm ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω–æ**. –≠—Ç–æ—Ç –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –Ω–µ –Ω—É–∂–µ–Ω –ø–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ.

---

### –®–∞–≥ 2. –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –æ—Å—Ç–∞–ª—Å—è –æ–¥–∏–Ω endpoint

```bash
grep -R "GetState" -n VpnService.Api/Controllers
grep -R "admin/wg/state" -n VpnService.Api/Controllers
```

–û–∂–∏–¥–∞–µ–º–æ: **–æ–¥–∏–Ω —Ñ–∞–π–ª, –æ–¥–∏–Ω –º–µ—Ç–æ–¥**.

---

### –®–∞–≥ 3. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å

```bash
dotnet build
dotnet run --project VpnService.Api
```

---

### –®–∞–≥ 4. –ü—Ä–æ–≥–Ω–∞—Ç—å devmenu –µ—â—ë —Ä–∞–∑

```bash
cd scripts/devmenu
./devmenu.sh
# –≤—ã–±—Ä–∞—Ç—å –ø—É–Ω–∫—Ç 9 (Stage 3 E2E)
```

### ‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

```
[INFO] [1] Health           -> OK
[INFO] [2] Login            -> OK
[INFO] [3] Admin WG State   -> HTTP/1.1 200 OK
```

**–ë–µ–∑ AmbiguousMatchException.**

---

# üß† –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ (–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ)

–¢—ã —Å–µ–π—á–∞—Å —Å–¥–µ–ª–∞–ª **–æ—á–µ–Ω—å –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –≤–µ—â—å**, –ø–æ–π–º–∞–≤ —ç—Ç–æ –Ω–∞ Stage 3:

* ‚ùå V1 admin endpoints ‚Üí –ª–æ–º–∞—é—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç
* ‚ùå –¥–≤–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö route ‚Üí –Ω–µ—É—Å—Ç–æ–π—á–∏–≤—ã–π API
* ‚ùå –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å reconciliation —Å—Ç–∞–±–∏–ª—å–Ω–æ

–ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è `V1/WireGuardAdminController`:

* ‚úî –æ–¥–∏–Ω –∫–æ–Ω—Ç—Ä–∞–∫—Ç
* ‚úî –æ–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã
* ‚úî devmenu —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–∞–¥—ë–∂–Ω—ã–º
* ‚úî –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ **Stage 3 Day 2 (write-path)**

---

# üß≠ –ß—Ç–æ –¥–∞–ª—å—à–µ (–ø–æ—Å–ª–µ —Ñ–∏–∫—Å–∞)

–°–ª–µ–¥—É—é—â–∏–π –ª–æ–≥–∏—á–Ω—ã–π —à–∞–≥, **–∫–æ–≥–¥–∞ Stage 3 Day 1 –∑–µ–ª—ë–Ω—ã–π**:

### Stage 3 Day 2

* `IWireGuardCommandWriter`
* `AddPeer`
* `RemovePeer`
* –Ω–æ–≤—ã–µ –ø—É–Ω–∫—Ç—ã –≤ devmenu:

  * `Add peer`
  * `Remove peer`

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å ‚Äî –≤ —Å–ª–µ–¥—É—é—â–µ–º —Å–æ–æ–±—â–µ–Ω–∏–∏:

* —è **–¥–∞–º —Ç–æ—á–Ω—ã–π diff**, –∫–∞–∫–æ–π —Ñ–∞–π–ª —É–¥–∞–ª–∏—Ç—å
* –∏–ª–∏ **—Å—Ä–∞–∑—É –Ω–∞—á–Ω—ë–º write-path** –ø–æ —Ç–æ–π –∂–µ —Å—Ö–µ–º–µ `pull ‚Üí ./devmenu.sh ‚Üí —Ä–∞–±–æ—Ç–∞–µ—Ç`

–¢—ã —Å–µ–π—á–∞—Å —Ä–µ–∞–ª—å–Ω–æ –≤ **—Ç–æ—á–∫–µ –ø–µ—Ä–µ—Ö–æ–¥–∞ –æ—Ç API –∫ —Ä–µ–∞–ª—å–Ω–æ–º—É VPN**. –í—Å—ë –∏–¥—ë—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ üí™
