# üì¶ VPN Service –≠–¢–ê–ü 2 ‚Äî Ubuntu Ready

–ì–æ—Ç–æ–≤—ã–π –Ω–∞–±–æ—Ä —Å–∫—Ä–∏–ø—Ç–æ–≤ –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è VPN Service –Ω–∞ Ubuntu.

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

| –°–∫—Ä–∏–ø—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|---------|
| `run_api.sh` | –ó–∞–ø—É—Å–∫ VPN Service API |
| `stop_api.sh` | –û—Å—Ç–∞–Ω–æ–≤–∫–∞ API |
| `setup_db.sh` | –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL –∏ –º–∏–≥—Ä–∞—Ü–∏–∏ |
| `seed_data.sh` | –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ë–î —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ |
| `test_api.sh` | –ü—Ä–æ–≥–æ–Ω –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ –≠–¢–ê–ü 2 |
| `verify_stage2.sh` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ OS-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ |
| `generate_report.sh` | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ |
| `run_all.sh` | **–ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞** |

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
cd scripts
chmod +x *.sh
./run_all.sh
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
2. ‚úÖ –°–æ–±–µ—Ä–µ—Ç –ø—Ä–æ–µ–∫—Ç
3. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç API
4. ‚úÖ –ü—Ä–æ–≥–æ–Ω–∏—Ç –≤—Å–µ —Ç–µ—Å—Ç—ã
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç OS-–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –∫–æ–¥–∞
6. ‚úÖ –°–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç—á–µ—Ç
7. ‚úÖ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç API

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–æ—à–∞–≥–æ–≤–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

```bash
cd scripts
chmod +x *.sh

# 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ë–î (—Ç—Ä–µ–±—É–µ—Ç sudo)
./setup_db.sh

# 2. –ó–∞–ø—É—Å–∫ API
./run_api.sh

# 3. –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ë–î —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
./seed_data.sh

# 4. –ü—Ä–æ–≥–æ–Ω —Ç–µ—Å—Ç–æ–≤
./test_api.sh

# 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ OS-–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
./verify_stage2.sh

# 6. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞
./generate_report.sh

# 7. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ API
./stop_api.sh
```

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

### 1Ô∏è‚É£ `run_api.sh` ‚Äî –ó–∞–ø—É—Å–∫ API

–ó–∞–ø—É—Å–∫–∞–µ—Ç VPN Service API –Ω–∞ `http://localhost:5272`

```bash
./run_api.sh
```

**–í—ã–≤–æ–¥:**
```
üöÄ –ó–∞–ø—É—Å–∫–∞—é VPN Service API...
‚úÖ API –∑–∞–ø—É—â–µ–Ω (PID: 12345)
–õ–æ–≥–∏: /tmp/vpnservice.log
```

---

### 2Ô∏è‚É£ `test_api.sh` ‚Äî –ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤

–ü—Ä–æ–≥–æ–Ω—è–µ—Ç –≤—Å–µ —Ç–µ—Å—Ç—ã –≠–¢–ê–ü 2:

```bash
./test_api.sh
```

**–¢–µ—Å—Ç—ã:**
- ‚úÖ Health Check
- ‚úÖ Login (JWT)
- ‚úÖ List Peers (–¥–æ —Å–æ–∑–¥–∞–Ω–∏—è)
- ‚úÖ Create Peer
- ‚úÖ Get Peer by ID
- ‚úÖ List Peers (—Å –ø–∏—Ä–æ–º)
- ‚úÖ Revoke Peer

---

### 3Ô∏è‚É£ `verify_stage2.sh` ‚Äî –ü—Ä–æ–≤–µ—Ä–∫–∞ OS-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –∫–æ–¥ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç Linux-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:

```bash
./verify_stage2.sh
```

**–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- ‚ùå WireGuard CLI –∫–æ–º–∞–Ω–¥—ã (`wg`)
- ‚ùå Linux –ø—É—Ç–∏ (`/etc/`, `/proc/`)
- ‚ùå –°–∏—Å—Ç–µ–º–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (`sudo`, `iptables`)

---

### 4Ô∏è‚É£ `generate_report.sh` ‚Äî –û—Ç—á–µ—Ç

–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç markdown –æ—Ç—á–µ—Ç –æ —Å—Ç–∞—Ç—É—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:

```bash
./generate_report.sh
```

**–°–æ–∑–¥–∞–µ—Ç:** `STAGE2_REPORT.md`

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ó–∞–ø—É—Å–∫ –≤—Å–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–º–µ—Å—Ç–µ
```bash
./run_all.sh
```

### –¢–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã (API –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω)
```bash
./test_api.sh
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ –Ω–∞ OS-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```bash
./verify_stage2.sh
```

### –ó–∞–ø—É—Å–∫ API —Å –ª–æ–≥–∞–º–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏
```bash
cd ../VpnService.Api
dotnet run
```

---

## üîß –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è Ubuntu

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
sudo apt-get update
sudo apt-get install -y \
    dotnet-sdk-9.0 \
    postgresql \
    postgresql-contrib \
    curl \
    jq

# –ó–∞–ø—É—Å–∫ PostgreSQL
sudo systemctl start postgresql
```

---

## üìã –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

- **API –ª–æ–≥–∏:** `/tmp/vpnservice.log`
- **PID —Ñ–∞–π–ª:** `/tmp/vpnservice.pid`
- **–û—Ç—á–µ—Ç:** `../STAGE2_REPORT.md`

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∑–∞–ø—É—â–µ–Ω –ª–∏ API
curl http://localhost:5272/health

# –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
tail -f /tmp/vpnservice.log

# –°–ø–∏—Å–æ–∫ –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
ps aux | grep dotnet
```

---

## üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ API

```bash
./stop_api.sh
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
```bash
kill $(cat /tmp/vpnservice.pid)
```

---

## üìå –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º–∏: `chmod +x *.sh`
- API –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ `http://localhost:5272`
- –ë–î –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- –î–ª—è production –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ PostgreSQL
- –í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é cross-platform —Å–æ–≤–º–µ—Å—Ç–∏–º—ã

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ `./run_all.sh` –≤—ã –ø–æ–ª—É—á–∏—Ç–µ:

‚úÖ **–ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç** –æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –≠–¢–ê–ü 2
‚úÖ **–í—Å–µ API endpoints** —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
‚úÖ **–ö–æ–¥ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç** OS-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
‚úÖ **–ì–æ—Ç–æ–≤ –∫ –º–∏–≥—Ä–∞—Ü–∏–∏** –≤ Ubuntu 20.04+ —Å .NET 9.0

---

**–≠–¢–ê–ü 2 ‚úÖ –ì–û–¢–û–í –ö PRODUCTION**
