-------------------------------------------
TASK: DB: ensure role + database
TIME_UTC: Пн 05 янв 2026 13:40:47 UTC
HOST: Vpn-Main
REPO_ROOT: /opt/vpn-service
-------------------------------------------
DB_MODE=system
PG_HOST=127.0.0.1
PG_PORT=5432
PG_DB=vpnservice
PG_USER=vpnservice
PG_PASSWORD=23***
PG_ADMIN_USER=postgres
Bootstrap user: postgres
Role: vpnservice
Database: vpnservice
+ psql (admin) ensure role/db (password redacted)
-------------------------------------------
TASK: DB: check role exists (system)
TIME_UTC: Пн 05 янв 2026 13:40:47 UTC
HOST: Vpn-Main
REPO_ROOT: /opt/vpn-service
-------------------------------------------
+ sudo -u postgres psql -v ON_ERROR_STOP=1 -Atc SELECT 1 FROM pg_roles WHERE rolname = 'vpnservice' LIMIT 1;
1
STATUS: 0

-------------------------------------------
TASK: DB: alter role (system)
TIME_UTC: Пн 05 янв 2026 13:40:47 UTC
HOST: Vpn-Main
REPO_ROOT: /opt/vpn-service
-------------------------------------------
+ sudo -u postgres psql -v ON_ERROR_STOP=1 -c ALTER ROLE "vpnservice" LOGIN PASSWORD '23***';
ALTER ROLE
STATUS: 0

-------------------------------------------
TASK: DB: check database exists (system)
TIME_UTC: Пн 05 янв 2026 13:40:47 UTC
HOST: Vpn-Main
REPO_ROOT: /opt/vpn-service
-------------------------------------------
+ sudo -u postgres psql -v ON_ERROR_STOP=1 -Atc SELECT 1 FROM pg_database WHERE datname = 'vpnservice' LIMIT 1;
1
STATUS: 0

