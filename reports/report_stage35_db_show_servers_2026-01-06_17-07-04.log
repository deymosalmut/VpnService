----------------------------------------------------------------
>>> Stage 3.5 â€” DB: show VpnServers + FK check (read-only)
----------------------------------------------------------------
----------------------------------------------------------------
>>> Load app DB env
----------------------------------------------------------------
+ CMD: bash -lc 
    cd '/opt/vpn-service'
    source scripts/lib/appdb.sh
    load_app_db_env '/opt/vpn-service/infra/local/app-db.env'
    echo "PG_DATABASE=$PG_DATABASE PG_USER=$PG_USER PG_HOST=$PG_HOST PG_PORT=$PG_PORT"
  
PG_DATABASE=vpnservice PG_USER=vpnservice PG_HOST=127.0.0.1 PG_PORT=5432
STATUS: OK (exit=0)
----------------------------------------------------------------
>>> VpnServers count
----------------------------------------------------------------
+ CMD: bash -lc 
    cd '/opt/vpn-service'
    source scripts/lib/appdb.sh
    load_app_db_env '/opt/vpn-service/infra/local/app-db.env'
    psql_app -Atc 'select count(*) from public."VpnServers";'
  
1
STATUS: OK (exit=0)
----------------------------------------------------------------
>>> VpnServers rows (top 20): Id|Name|Gateway|Network
----------------------------------------------------------------
+ CMD: bash -lc 
    cd '/opt/vpn-service'
    source scripts/lib/appdb.sh
    load_app_db_env '/opt/vpn-service/infra/local/app-db.env'
    psql_app -Atc "
      select
        \"Id\"::text||'|'||
        coalesce(\"Name\",  '')||'|'||
        coalesce(\"Gateway\",'')||'|'||
        coalesce(\"Network\",'')
      from public.\"VpnServers\"
      order by \"CreatedAt\" desc
      limit 20;
    "
  
01a9e169-2e7c-4e76-8272-0469d175b0f3|wg1|10.8.0.1/32|10.8.0.0/24
STATUS: OK (exit=0)
----------------------------------------------------------------
>>> FK check: does peer.VpnServerId exist in VpnServers?
----------------------------------------------------------------
+ CMD: bash -lc 
    cd '/opt/vpn-service'
    source scripts/lib/appdb.sh
    load_app_db_env '/opt/vpn-service/infra/local/app-db.env'
    psql_app -Atc "
      select count(*)
      from public.\"VpnServers\"
      where \"Id\" = (select \"VpnServerId\" from public.\"VpnPeers\" limit 1);
    "
  
1
STATUS: OK (exit=0)
----------------------------------------------------------------
>>> DONE
----------------------------------------------------------------
