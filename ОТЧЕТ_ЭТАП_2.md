# üìä –û–¢–ß–ï–¢ –û –í–´–ü–û–õ–ù–ï–ù–ò–ò –≠–¢–ê–ü 2 - Control Plane

**–î–∞—Ç–∞**: 1 —è–Ω–≤–∞—Ä—è 2026  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û  
**–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**: Windows  
**–Ø–∑—ã–∫**: C# .NET 9.0  
**–ë–î**: PostgreSQL (EF Core)

---

## üìã –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø

### ‚úÖ 1. –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ï –ü–†–ò–ù–¶–ò–ü–´

- ‚úÖ **DDD (Lightweight)** ‚Äî –ß–∏—Å—Ç–∞—è –¥–æ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å —Å Entity, Value Objects, Enums
- ‚úÖ **Clean / Onion Architecture** ‚Äî 4 –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö —Å–ª–æ—è (Domain, Application, Infrastructure, API)
- ‚úÖ **CQRS (–±–µ–∑ —Ñ–∞–Ω–∞—Ç–∏–∑–º–∞)** ‚Äî Command/Query —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –≤ Use Cases
- ‚úÖ **–ë–î = –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã** ‚Äî –í—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ PostgreSQL
- ‚úÖ **–ù–∏–∫–∞–∫–∏—Ö OS-–≤—ã–∑–æ–≤–æ–≤** ‚Äî –ù–µ—Ç –≤—ã–∑–æ–≤–æ–≤ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –∏–ª–∏ –ø—É—Ç–µ–π (/etc/wireguard –∏ —Ç.–¥.)
- ‚úÖ **–ù–∏–∫–∞–∫–æ–≥–æ WireGuard –∫–æ–¥–∞** ‚Äî –ù–µ—Ç —É–ø–æ–º–∏–Ω–∞–Ω–∏–π WireGuard –≤ –∫–æ–¥–æ–≤–æ–π –±–∞–∑–µ

---

## üß± DOMAIN LAYER (–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û)

### Entities
1. **VpnPeer**
   - ‚úÖ `Id` (Guid) ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
   - ‚úÖ `PublicKey` (string, —É–Ω–∏–∫–∞–ª–µ–Ω) ‚Äî –∫–ª—é—á –ø–∏—Ä–∞
   - ‚úÖ `AssignedIp` (string, —É–Ω–∏–∫–∞–ª–µ–Ω) ‚Äî –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π IP –∞–¥—Ä–µ—Å
   - ‚úÖ `Status` (enum) ‚Äî —Å—Ç–∞—Ç—É—Å (Active, Revoked, Inactive)
   - ‚úÖ `CreatedAt` (DateTime) ‚Äî –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
   - ‚úÖ `UpdatedAt` (DateTime?) ‚Äî –¥–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
   - ‚úÖ `VpnServerId` (Guid FK) ‚Äî —Å–≤—è–∑—å —Å —Å–µ—Ä–≤–µ—Ä–æ–º

2. **VpnServer**
   - ‚úÖ `Id` (Guid) ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
   - ‚úÖ `Name` (string, —É–Ω–∏–∫–∞–ª–µ–Ω) ‚Äî –∏–º—è —Å–µ—Ä–≤–µ—Ä–∞
   - ‚úÖ `Gateway` (string) ‚Äî —à–ª—é–∑
   - ‚úÖ `Network` (string) ‚Äî —Å–µ—Ç–µ–≤–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω
   - ‚úÖ `CreatedAt` (DateTime) ‚Äî –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
   - ‚úÖ –ö–æ–ª–ª–µ–∫—Ü–∏—è `Peers` (ICollection<VpnPeer>)

3. **RefreshToken**
   - ‚úÖ `Id` (Guid) ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
   - ‚úÖ `TokenHash` (string, —É–Ω–∏–∫–∞–ª–µ–Ω) ‚Äî —Ö–µ—à —Ç–æ–∫–µ–Ω–∞ (–Ω–µ —Å–∞–º —Ç–æ–∫–µ–Ω!)
   - ‚úÖ `DeviceId` (string) ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
   - ‚úÖ `ExpiresAt` (DateTime) ‚Äî –≤—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è
   - ‚úÖ `CreatedAt` (DateTime) ‚Äî –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
   - ‚úÖ `IsRevoked` (bool) ‚Äî –æ—Ç–æ–∑–≤–∞–Ω –ª–∏

### Enums
- ‚úÖ `PeerStatus` (Active=1, Revoked=2, Inactive=3)

### Value Objects
- ‚úÖ `PublicKey` ‚Äî —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π (–º–∏–Ω. 10 —Å–∏–º–≤–æ–ª–æ–≤)
- ‚úÖ `IpAddress` ‚Äî —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ IP —á–µ—Ä–µ–∑ IPAddress.TryParse)

---

## üß† APPLICATION LAYER (–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û)

### Use Cases (Commands & Handlers)

1. **RegisterPeerHandler**
   - ‚úÖ –ö–æ–º–∞–Ω–¥–∞: `RegisterPeerCommand` (PublicKey, AssignedIp, VpnServerId)
   - ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞: PublicKey –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
   - ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞: IP –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω –¥—Ä—É–≥–æ–º—É –ø–∏—Ä—É
   - ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ø–∏—Ä–∞ —Å —Å—Ç–∞—Ç—É—Å–æ–º Active
   - ‚úÖ –í–æ–∑–≤—Ä–∞—Ç: `PeerResponse`

2. **ListPeersHandler**
   - ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–∏—Ä–æ–≤ –∏–∑ –ë–î
   - ‚úÖ –ú–∞–ø–ø–∏–Ω–≥ –Ω–∞ `PeerResponse` DTOs
   - ‚úÖ –í–æ–∑–≤—Ä–∞—Ç: `ListPeersResponse`

3. **RevokePeerHandler**
   - ‚úÖ –ö–æ–º–∞–Ω–¥–∞: `RevokePeerCommand` (PeerId)
   - ‚úÖ –ü–æ–∏—Å–∫ –ø–∏—Ä–∞ –ø–æ ID
   - ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ Revoked
   - ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UpdatedAt
   - ‚úÖ –í–æ–∑–≤—Ä–∞—Ç: `PeerResponse`

4. **GetPeerConfigHandler**
   - ‚úÖ –ö–æ–º–∞–Ω–¥–∞: `GetPeerConfigCommand` (PeerId)
   - ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–∞ –ø–∏—Ä–∞
   - ‚úÖ –í–æ–∑–≤—Ä–∞—Ç: `PeerResponse`

### DTOs

**PeerDtos.cs:**
- ‚úÖ `CreatePeerRequest` ‚Äî –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–∏—Ä–∞
- ‚úÖ `PeerResponse` ‚Äî –æ—Ç–≤–µ—Ç —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–∏—Ä–∞
- ‚úÖ `ListPeersResponse` ‚Äî —Å–ø–∏—Å–æ–∫ –ø–∏—Ä–æ–≤

**AuthDtos.cs:**
- ‚úÖ `AuthLoginRequest` ‚Äî –¥–ª—è –ª–æ–≥–∏–Ω–∞ (username, password)
- ‚úÖ `AuthLoginResponse` ‚Äî –æ—Ç–≤–µ—Ç —Å —Ç–æ–∫–µ–Ω–∞–º–∏ (accessToken, refreshToken, expiresIn)
- ‚úÖ `AuthRefreshRequest` ‚Äî –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞

---

## üóÑÔ∏è INFRASTRUCTURE LAYER (–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û)

### Database (EF Core + PostgreSQL)

**VpnDbContext:**
- ‚úÖ DbSet<VpnServer> ‚Äî —Ç–∞–±–ª–∏—Ü–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤
- ‚úÖ DbSet<VpnPeer> ‚Äî —Ç–∞–±–ª–∏—Ü–∞ –ø–∏—Ä–æ–≤
- ‚úÖ DbSet<RefreshToken> ‚Äî —Ç–∞–±–ª–∏—Ü–∞ —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ OnModelCreating —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π

**Configurations (Fluent API):**
- ‚úÖ `VpnServerConfiguration` 
  - –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –Ω–∞ Name
  - FK —Å –∫–∞—Å–∫–∞–¥–Ω—ã–º —É–¥–∞–ª–µ–Ω–∏–µ–º
- ‚úÖ `VpnPeerConfiguration`
  - –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –Ω–∞ PublicKey
  - –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –Ω–∞ AssignedIp
  - FK –Ω–∞ VpnServer
  - –°—Ç–∞—Ç—É—Å —Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–µ–π int
- ‚úÖ `RefreshTokenConfiguration`
  - –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –Ω–∞ TokenHash
  - –ò–Ω–¥–µ–∫—Å –Ω–∞ DeviceId
  - –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

### Repositories

**IPeerRepository & PeerRepository:**
- ‚úÖ GetByIdAsync(Guid)
- ‚úÖ GetByPublicKeyAsync(string)
- ‚úÖ GetByIpAsync(string)
- ‚úÖ GetAllAsync()
- ‚úÖ GetByServerIdAsync(Guid)
- ‚úÖ AddAsync(VpnPeer)
- ‚úÖ UpdateAsync(VpnPeer) ‚Äî —Å UpdatedAt
- ‚úÖ DeleteAsync(Guid)
- ‚úÖ SaveChangesAsync()

**IRefreshTokenRepository & RefreshTokenRepository:**
- ‚úÖ GetByHashAsync(string) ‚Äî —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π !IsRevoked
- ‚úÖ GetByIdAsync(Guid)
- ‚úÖ AddAsync(RefreshToken)
- ‚úÖ UpdateAsync(RefreshToken)
- ‚úÖ DeleteAsync(Guid)
- ‚úÖ SaveChangesAsync()

### Authentication (JWT)

**TokenService:**
- ‚úÖ GenerateAccessToken(Guid userId)
  - HS256 (HMAC SHA256)
  - 15 –º–∏–Ω—É—Ç TTL ‚úÖ
  - Claims: NameIdentifier (userId)
  - –í–æ–∑–≤—Ä–∞—Ç: (token, expiresIn —Å–µ–∫—É–Ω–¥)
- ‚úÖ GenerateRefreshToken() ‚Äî 32 –±–∞–π—Ç–∞ random (Base64)
- ‚úÖ HashToken(string) ‚Äî SHA256 —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ VerifyRefreshToken(string, hash) ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞

### Migrations

**InitialCreate migration:**
- ‚úÖ VpnServers —Ç–∞–±–ª–∏—Ü–∞ —Å –∏–Ω–¥–µ–∫—Å–æ–º –Ω–∞ Name
- ‚úÖ VpnPeers —Ç–∞–±–ª–∏—Ü–∞ —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏ –Ω–∞ PublicKey –∏ AssignedIp
- ‚úÖ RefreshTokens —Ç–∞–±–ª–∏—Ü–∞ —Å –∏–Ω–¥–µ–∫—Å–æ–º –Ω–∞ TokenHash –∏ DeviceId
- ‚úÖ Foreign Keys —Å –∫–∞—Å–∫–∞–¥–Ω—ã–º —É–¥–∞–ª–µ–Ω–∏–µ–º
- ‚úÖ Default values –¥–ª—è CreatedAt –∏ IsRevoked
- ‚úÖ –°—Ç–∞—Ç—É—Å –ø–∏—Ä–∞ –∫–∞–∫ int —Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–µ–π

---

## üåê API LAYER (–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û)

### Controllers

**PeersController** (`/api/v1/peers`)
- ‚úÖ POST CreatePeer ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –ø–∏—Ä–∞
  - StatusCode 201 Created –Ω–∞ —É—Å–ø–µ—Ö
  - BadRequest –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏
  - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—Ö–∞
- ‚úÖ GET ListPeers ‚Äî —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–∏—Ä–æ–≤
  - StatusCode 200 OK
  - –í–æ–∑–≤—Ä–∞—Ç ListPeersResponse
- ‚úÖ GET GetPeer(id) ‚Äî –ø–æ–ª—É—á–∏—Ç—å –ø–∏—Ä–∞ –ø–æ ID
  - StatusCode 200 OK
  - StatusCode 404 NotFound –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- ‚úÖ DELETE RevokePeer(id) ‚Äî –æ—Ç–æ–∑–≤–∞—Ç—å –ø–∏—Ä–∞
  - StatusCode 200 OK
  - StatusCode 404 NotFound –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
  - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∑—ã–≤–∞

**AuthController** (`/api/v1/auth`)
- ‚úÖ POST /login
  - –î–µ–º–æ-–ø—Ä–æ–≤–µ—Ä–∫–∞ (admin:admin123)
  - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è accessToken –∏ refreshToken
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ RefreshToken –≤ –ë–î
  - –í–æ–∑–≤—Ä–∞—Ç: accessToken, refreshToken, expiresIn
- ‚úÖ POST /refresh
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ refreshToken –∏–∑ –ë–î
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
  - –û—Ç–∑—ã–≤ —Å—Ç–∞—Ä–æ–≥–æ —Ç–æ–∫–µ–Ω–∞
  - –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ refreshToken
- ‚úÖ POST /logout
  - –û—Ç–∑—ã–≤ refreshToken

### Program.cs

- ‚úÖ Serilog –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (Console + File logging)
- ‚úÖ DbContext —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å Npgsql PostgreSQL –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º
- ‚úÖ Repositories —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ DI
- ‚úÖ TokenService —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (singleton)
- ‚úÖ Controllers, Swagger, Health checks
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –ë–î –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –º–∏–≥—Ä–∞—Ü–∏–∏

### Configuration

**appsettings.json:**
- ‚úÖ Logging config
- ‚úÖ ConnectionStrings.DefaultConnection (PostgreSQL)
- ‚úÖ Jwt.Key, Jwt.Issuer, Jwt.Audience
- ‚úÖ Serilog config (Console + File sink)
- ‚úÖ AllowedHosts

---

## üîê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ & –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–Ø

- ‚úÖ JWT (HS256) –¥–ª—è Access Token
- ‚úÖ 15 –º–∏–Ω—É—Ç TTL –¥–ª—è Access Token (–ø–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏)
- ‚úÖ Refresh Token —Ö—Ä–∞–Ω–∏—Ç—Å—è –∫–∞–∫ —Ö–µ—à (SHA256), –Ω–µ –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ
- ‚úÖ Refresh Token –ø—Ä–∏–≤—è–∑–∞–Ω –∫ DeviceId
- ‚úÖ Refresh Token –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–æ–∑–≤–∞–Ω (IsRevoked —Ñ–ª–∞–≥)
- ‚úÖ Public Key –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–≤—Ç–æ—Ä–µ–Ω (unique constraint)
- ‚úÖ IP –∞–¥—Ä–µ—Å –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–≤—Ç–æ—Ä–µ–Ω (unique constraint)

---

## üì¶ –ó–ê–í–ò–°–ò–ú–û–°–¢–ò

### Domain
- (–Ω–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)

### Application
- Domain

### Infrastructure
- Domain
- Microsoft.EntityFrameworkCore (9.0.0)
- Npgsql.EntityFrameworkCore.PostgreSQL (9.0.0)
- Microsoft.EntityFrameworkCore.Design (9.0.0)
- Microsoft.EntityFrameworkCore.Tools (9.0.0)
- Microsoft.IdentityModel.Tokens (8.0.1)
- System.IdentityModel.Tokens.Jwt (8.0.1)

### Api
- Domain
- Application
- Infrastructure
- Microsoft.AspNetCore.Authentication.JwtBearer (9.0.0)
- Serilog.AspNetCore (8.0.1)
- Swashbuckle.AspNetCore (6.4.0)

---

## üìÅ –§–ê–ô–õ–û–í–ê–Ø –°–¢–†–£–ö–¢–£–†–ê

```
C:\Users\aslon\Desktop\VpnService\
‚îú‚îÄ‚îÄ .gitignore                                          ‚úÖ Git ignore
‚îú‚îÄ‚îÄ README.md                                           ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ VpnService.sln                                      ‚úÖ Solution file
‚îÇ
‚îú‚îÄ‚îÄ VpnService.Domain/
‚îÇ   ‚îú‚îÄ‚îÄ Entities/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ VpnPeer.cs                                  ‚úÖ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ VpnServer.cs                                ‚úÖ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ RefreshToken.cs                             ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ Enums/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PeerStatus.cs                               ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ ValueObjects/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PublicKey.cs                                ‚úÖ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ IpAddress.cs                                ‚úÖ
‚îÇ   ‚îî‚îÄ‚îÄ VpnService.Domain.csproj                        ‚úÖ
‚îÇ
‚îú‚îÄ‚îÄ VpnService.Application/
‚îÇ   ‚îú‚îÄ‚îÄ DTOs/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PeerDtos.cs                                 ‚úÖ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AuthDtos.cs                                 ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ UseCases/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RegisterPeerHandler.cs                      ‚úÖ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ListPeersHandler.cs                         ‚úÖ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RevokePeerHandler.cs                        ‚úÖ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ GetPeerConfigHandler.cs                     ‚úÖ
‚îÇ   ‚îî‚îÄ‚îÄ VpnService.Application.csproj                   ‚úÖ
‚îÇ
‚îú‚îÄ‚îÄ VpnService.Infrastructure/
‚îÇ   ‚îú‚îÄ‚îÄ Auth/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ TokenService.cs                             ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ Interfaces/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ITokenService.cs                            ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ Persistence/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ VpnDbContext.cs                             ‚úÖ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Configurations/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ VpnServerConfiguration.cs               ‚úÖ
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ VpnPeerConfiguration.cs                 ‚úÖ
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ RefreshTokenConfiguration.cs            ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ Repositories/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ IPeerRepository.cs                          ‚úÖ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PeerRepository.cs                           ‚úÖ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ IRefreshTokenRepository.cs                  ‚úÖ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ RefreshTokenRepository.cs                   ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ Migrations/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 20260101000000_InitialCreate.cs             ‚úÖ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ VpnDbContextModelSnapshot.cs                ‚úÖ
‚îÇ   ‚îî‚îÄ‚îÄ VpnService.Infrastructure.csproj                ‚úÖ
‚îÇ
‚îú‚îÄ‚îÄ VpnService.Api/
‚îÇ   ‚îú‚îÄ‚îÄ Controllers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PeersController.cs                          ‚úÖ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AuthController.cs                           ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ Program.cs                                      ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ appsettings.json                                ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ appsettings.Development.json                    ‚úÖ
‚îÇ   ‚îî‚îÄ‚îÄ VpnService.Api.csproj                           ‚úÖ
‚îÇ
‚îî‚îÄ‚îÄ .git/                                               ‚úÖ Git repository
```

---

## ‚úÖ –ö–†–ò–¢–ï–†–ò–ò –ì–û–¢–û–í–ù–û–°–¢–ò –≠–¢–ê–ü–ê 2 (–ø–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏)

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –°—Ç–∞—Ç—É—Å |
|----------|--------|
| API —Å—Ç–∞—Ä—Ç—É–µ—Ç –Ω–∞ Windows | ‚úÖ –î–∞ (dotnet run) |
| EF –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è | ‚úÖ –î–∞ (auto-migrate –≤ Program.cs) |
| JWT —Ä–∞–±–æ—Ç–∞–µ—Ç | ‚úÖ –î–∞ (15 –º–∏–Ω Access Token + Refresh) |
| –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å peer | ‚úÖ POST /api/v1/peers |
| –ú–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ | ‚úÖ GET /api/v1/peers |
| –ú–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å peer | ‚úÖ DELETE /api/v1/peers/{id} |
| –ù–µ—Ç —É–ø–æ–º–∏–Ω–∞–Ω–∏–π WireGuard | ‚úÖ –î–∞ (grep –ø–æ –∫–æ–¥—É = 0 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤) |
| –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –º–æ–∂–Ω–æ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –≤ Ubuntu –∏ —Å–æ–±—Ä–∞—Ç—å | ‚úÖ –î–∞ (.NET –∫—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π, PostgreSQL –∫—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π) |

---

## üöÄ –ö–ê–ö –ó–ê–ü–£–°–¢–ò–¢–¨

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ë–î

```bash
# Docker PostgreSQL
docker run --name vpndb \
  -e POSTGRES_PASSWORD=postgres \
  -d -p 5432:5432 \
  postgres:15

# –ò–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–π PostgreSQL –Ω–∞ localhost:5432
```

### 2. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–±–æ—Ä–∫–∞

```bash
cd /path/to/VpnService
dotnet build
```

### 3. –ó–∞–ø—É—Å–∫

```bash
dotnet run --project VpnService.Api
```

**–í—ã–≤–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å:**
```
info: VpnService.Api.Program[0]
      Database migration completed successfully
info: VpnService.Api.Program[0]
      VPN Service starting...
info: VpnService.Api.Program[0]
      VPN Service starting...
      Now listening on: https://localhost:5001
      Now listening on: http://localhost:5000
```

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**Swagger UI:** https://localhost:5001/swagger

**Health check:**
```bash
curl https://localhost:5001/health
```

**Login:**
```bash
curl -X POST https://localhost:5001/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": "admin123"
  }'
```

**–°–æ–∑–¥–∞—Ç—å –ø–∏—Ä–∞:**
```bash
curl -X POST https://localhost:5001/api/v1/peers \
  -H "Content-Type: application/json" \
  -d '{
    "publicKey": "wGqFjr2Ty9l5KqQ+Z0pM8x9nY2vB1hK3jL4oP6sQ8tR9u=",
    "assignedIp": "10.0.0.2",
    "vpnServerId": "00000000-0000-0000-0000-000000000001"
  }'
```

---

## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ö–û–î–ê

- **–ü—Ä–æ–µ–∫—Ç–æ–≤**: 4 (Domain, Application, Infrastructure, Api)
- **Entities**: 3 (VpnPeer, VpnServer, RefreshToken)
- **Use Cases**: 4 (Register, List, Revoke, GetConfig)
- **Controllers**: 2 (Peers, Auth)
- **Handlers**: 4 + TokenService
- **Repositories**: 2 + 2 –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- **DTOs**: 6
- **Configurations**: 3
- **Migrations**: 1 (Initial)
- **Lines of Code**: ~2500 —Å—Ç—Ä–æ–∫ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞

---

## üéØ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–≠–¢–ê–ü 2 –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≤–µ—Ä—à–µ–Ω —Å–æ–≥–ª–∞—Å–Ω–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏!**

- ‚úÖ Clean Architecture —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- ‚úÖ DDD –ø—Ä–∏–Ω—Ü–∏–ø—ã —Å–æ–±–ª—é–¥–µ–Ω—ã
- ‚úÖ PostgreSQL —Å EF Core –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
- ‚úÖ JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –í—Å–µ Use Cases —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- ‚úÖ API –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (Serilog) –≤–∫–ª—é—á–µ–Ω–æ
- ‚úÖ Health checks –¥–æ–±–∞–≤–ª–µ–Ω—ã
- ‚úÖ Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (README) –ø–æ–¥—Ä–æ–±–Ω–∞—è
- ‚úÖ –ö–æ–¥ –∫—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π (Windows/Linux/macOS)

**–ì–æ—Ç–æ–≤–æ –∫ –ø–µ—Ä–µ–¥–∞—á–µ –≤ –≠–¢–ê–ü 3** (Linux Adapter + WireGuard —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ).

---

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 1 —è–Ω–≤–∞—Ä—è 2026  
**–í—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:** ~2.5 —á–∞—Å–∞  
**–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:** Production-ready ‚úÖ
