# üì¶ –≠–¢–ê–ü 2 ‚Äî –ì–æ—Ç–æ–≤ –∫ Ubuntu Migration

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 1 —è–Ω–≤–∞—Ä—è 2026  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ì–û–¢–û–í–û –ö PRODUCTION**

---

## üéØ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1Ô∏è‚É£ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–æ–¥–∞
- ‚úÖ –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç .NET Standard 2.1+ (cross-platform)
- ‚úÖ –ù–µ—Ç Linux/Windows —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –ø—É—Ç–µ–π
- ‚úÖ –ù–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ (wg, sudo, iptables)
- ‚úÖ PostgreSQL –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≥–æ—Ç–æ–≤–∞
- ‚úÖ In-Memory –ë–î –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### 2Ô∏è‚É£ API —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ Health Check (`/health`)
- ‚úÖ JWT Authentication (`/api/v1/auth/login`)
- ‚úÖ Refresh Token (`/api/v1/auth/refresh`)
- ‚úÖ CRUD –¥–ª—è Peers:
  - `POST /api/v1/peers` ‚Äî Create
  - `GET /api/v1/peers` ‚Äî List
  - `GET /api/v1/peers/{id}` ‚Äî Get by ID
  - `DELETE /api/v1/peers/{id}` ‚Äî Revoke

### 3Ô∏è‚É£ –ù–∞–±–æ—Ä —Å–∫—Ä–∏–ø—Ç–æ–≤ –¥–ª—è Ubuntu
–°–æ–∑–¥–∞–Ω–∞ –ø–∞–ø–∫–∞ `scripts/` —Å –ø–æ–ª–Ω—ã–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ä–∏–µ–º:

| –°–∫—Ä–∏–ø—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|--------|-----------|
| `run_api.sh` | –ó–∞–ø—É—Å–∫ API –≤ —Ñ–æ–Ω–µ |
| `stop_api.sh` | –û—Å—Ç–∞–Ω–æ–≤–∫–∞ API |
| `setup_db.sh` | –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL |
| `seed_data.sh` | –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ë–î —Ç–µ—Å—Ç–∞–º–∏ |
| `test_api.sh` | –ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤ |
| `verify_stage2.sh` | –ü—Ä–æ–≤–µ—Ä–∫–∞ OS-–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ |
| `generate_report.sh` | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç |
| `run_all.sh` | **–ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** |

### 4Ô∏è‚É£ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
–í—Å–µ —Ç–µ—Å—Ç—ã –≠–¢–ê–ü 2 —Ä–∞–±–æ—Ç–∞—é—Ç:
- ‚úÖ Health Check ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç "Healthy"
- ‚úÖ Login ‚Äî –≤—ã–¥–∞–µ—Ç JWT —Ç–æ–∫–µ–Ω—ã
- ‚úÖ Refresh Token ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ List Peers ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–∏—Ä–æ–≤
- ‚úÖ Create Peer ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–∏—Ä–∞
- ‚úÖ Get Peer by ID ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–∏—Ä–∞ –ø–æ ID
- ‚úÖ Revoke Peer ‚Äî –æ—Ç–∑—ã–≤ –ø–∏—Ä–∞ (—Å—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ 2)

---

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞ Ubuntu

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–≤—Å—ë –≤ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–µ)
```bash
cd scripts
chmod +x *.sh
./run_all.sh
```

### –ò–ª–∏ –ø–æ—à–∞–≥–æ–≤–æ
```bash
# 1. –ó–∞–ø—É—Å–∫ API
./run_api.sh

# 2. –ü—Ä–æ–≥–æ–Ω —Ç–µ—Å—Ç–æ–≤ (–≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)
./test_api.sh

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ OS-–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
./verify_stage2.sh

# 4. –û—Ç—á–µ—Ç
./generate_report.sh

# 5. –û—Å—Ç–∞–Ω–æ–≤–∫–∞
./stop_api.sh
```

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏

### ‚úÖ API Endpoints
```
‚úÖ GET    /health
‚úÖ POST   /api/v1/auth/login
‚úÖ POST   /api/v1/auth/refresh
‚úÖ GET    /api/v1/peers
‚úÖ POST   /api/v1/peers
‚úÖ GET    /api/v1/peers/{id}
‚úÖ DELETE /api/v1/peers/{id}
```

### ‚úÖ OS-–ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
- ‚úÖ –ù–µ—Ç —Å—Å—ã–ª–æ–∫ –Ω–∞ `wg` –∫–æ–º–∞–Ω–¥—É
- ‚úÖ –ù–µ—Ç —Å—Å—ã–ª–æ–∫ –Ω–∞ `wireguard`
- ‚úÖ –ù–µ—Ç —Å—Å—ã–ª–æ–∫ –Ω–∞ `iptables`
- ‚úÖ –ù–µ—Ç —Å—Å—ã–ª–æ–∫ –Ω–∞ `/etc/`
- ‚úÖ –ù–µ—Ç —Å—Å—ã–ª–æ–∫ –Ω–∞ `/proc/`
- ‚úÖ –ù–µ—Ç —Å—Å—ã–ª–æ–∫ –Ω–∞ `sudo`

### ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
```
VpnService/
‚îú‚îÄ‚îÄ VpnService.Domain          (—Å—É—â–Ω–æ—Å—Ç–∏)
‚îú‚îÄ‚îÄ VpnService.Application     (use cases)
‚îú‚îÄ‚îÄ VpnService.Infrastructure  (—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏)
‚îú‚îÄ‚îÄ VpnService.Api             (REST –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã)
‚îî‚îÄ‚îÄ scripts/                    (Ubuntu —Å–∫—Ä–∏–ø—Ç—ã)
```

---

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è Ubuntu

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞
sudo apt-get update
sudo apt-get install -y \
    dotnet-sdk-9.0 \
    postgresql \
    curl \
    jq

# –ó–∞–ø—É—Å–∫ PostgreSQL
sudo systemctl start postgresql
sudo systemctl enable postgresql
```

---

## üìù –§–∞–π–ª—ã –æ—Ç—á–µ—Ç–æ–≤

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã:
- `STAGE2_REPORT.md` ‚Äî –ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç –æ –ø—Ä–æ–≤–µ—Ä–∫–µ
- `/tmp/vpnservice.log` ‚Äî –õ–æ–≥–∏ API
- `/tmp/vpnservice.pid` ‚Äî PID —Ñ–∞–π–ª API

---

## üéØ –ß—Ç–æ –¥–∞–ª—å—à–µ

### –≠–¢–ê–ü 3: Data Plane (WireGuard –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)
–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –Ω–∞ Ubuntu –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫:
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ WireGuard –Ω–∞ Linux –º–∞—à–∏–Ω–µ
- –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–π VM/–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
- –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- ‚úÖ –ö–æ–¥ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ localhost:5272
- ‚úÖ –í—Å–µ endpoints —Ç–µ—Å—Ç–∏—Ä—É—é—Ç—Å—è –∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞
- ‚úÖ –ë–î —Ä–∞–±–æ—Ç–∞–µ—Ç (in-memory –¥–ª—è dev, PostgreSQL –¥–ª—è prod)
- ‚úÖ –ù–µ—Ç OS-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- ‚úÖ –°–∫—Ä–∏–ø—Ç—ã –≥–æ—Ç–æ–≤—ã –¥–ª—è Ubuntu
- ‚úÖ –û—Ç—á–µ—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω—ã

---

## üéâ –≠–¢–ê–ü 2 –ó–ê–í–ï–†–®–ï–ù –ò –ì–û–¢–û–í –ö –ú–ò–ì–†–ê–¶–ò–ò

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **PRODUCTION READY**

–ö–æ–¥ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω –Ω–∞ Ubuntu, –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ clean –∏ scalable.

–ì–æ—Ç–æ–≤–æ –∫ –≠–¢–ê–ü 3!
